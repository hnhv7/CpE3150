#include "reg932.inc"

CSEG at 00h

MOV P3M1, #00H
MOV P3M2, #00H
MOV P2M1, #00H
MOV P2M2, #00H
MOV P1M1, #00H
MOV P1M2, #00H
MOV P0M1, #00H
MOV P0M2, #00H

MOV R3, #0H
CLR A
BEGIN: JNB P0.1, IC
       JNB P2.3, DC
       SJMP BEGIN

IC: 
    ACALL INPUTDELAY
	CJNE R3, #0FH, INL
    MOV R3, #0H
     ACALL PLIGHTS
	 ACALL SOUND
	 ACALL INPUTDELAY
     SJMP BEGIN
   


INL:   
    INC R3
    ACALL PLIGHTS
	SJMP BEGIN


DC:	
    ACALL INPUTDELAY
    CJNE R3, #0, DCL
		 MOV R3, #0FH
     ACALL PLIGHTS
	 ACALL SOUND
	 ACALL INPUTDELAY
     SJMP BEGIN

DCL: 
	DEC R3
    ACALL PLIGHTS
	SJMP BEGIN

PLIGHTS: 
   MOV A, R3
CPL A
MOV C, ACC.0
MOV P2.6, C
MOV C, ACC.1
MOV P0.7, C
MOV C, ACC.2
MOV P2.5, C
MOV C, ACC.3
MOV P0.4, C
RET
  RET

SOUND: MOV R4, #100
 BACK:
 CPL P1.7
ACALL DELAY
DJNZ R4, BACK
       RET

DELAY: MOV R0, #150
LOOPS: MOV R1, #6
LOOPZ: DJNZ R1, LOOPZ
DJNZ R0, LOOPS
RET

INPUTDELAY: MOV R1, #10
LOOP3: MOV R2, #255
LOOP2: MOV R4, #255
ILOOP: DJNZ R4, ILOOP
DJNZ R2, LOOP2
DJNZ R1, LOOP3
RET
 END
